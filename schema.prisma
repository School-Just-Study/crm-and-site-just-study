// This file is automatically generated by Keystone, do not modify it manually.
// Modify your Keystone config when you want to change this.

datasource postgresql {
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
  provider          = "postgresql"
}

generator client {
  provider = "prisma-client-js"
  output   = "node_modules/.prisma/client"
}

model Cart {
  id               String         @id @default(cuid())
  user             User?          @relation("Cart_user", fields: [userId], references: [id])
  userId           String?        @map("user")
  subscriptions    Subscription[] @relation("Cart_subscriptions")
  services         Service[]      @relation("Cart_services")
  quantityPayments Int?           @default(1)
  lastModification DateTime?      @default(now()) @updatedAt

  @@index([userId])
}

model Category {
  id                      String     @id @default(cuid())
  language                String     @default("ru")
  name                    String     @default("")
  parent                  Category?  @relation("Category_parent", fields: [parentId], references: [id])
  parentId                String?    @map("parent")
  products                Product[]  @relation("Category_products")
  statusView              String     @default("draft")
  createdAt               DateTime?  @default(now())
  lastModification        DateTime?  @default(now()) @updatedAt
  from_Category_parent    Category[] @relation("Category_parent")
  from_Product_categories Product[]  @relation("Product_categories")
  from_Service_categories Service[]  @relation("Service_categories")
  from_Tag_category       Tag[]      @relation("Tag_category")

  @@index([parentId])
}

model Order {
  id               String           @id @default(cuid())
  student          User?            @relation("Order_student", fields: [studentId], references: [id])
  studentId        String?          @map("student")
  leftPayments     Int              @default(1)
  payments         Payment[]        @relation("Payment_order")
  employee         User?            @relation("Order_employee", fields: [employeeId], references: [id])
  employeeId       String?          @map("employee")
  status           OrderStatusType? @default(created)
  subscriptions    Subscription[]   @relation("Order_subscriptions")
  services         Service[]        @relation("Order_services")
  amount           Int?
  createdAt        DateTime?        @default(now())
  lastModification DateTime?        @default(now()) @updatedAt

  @@index([studentId])
  @@index([employeeId])
}

model Payment {
  id               String             @id @default(cuid())
  order            Order?             @relation("Payment_order", fields: [orderId], references: [id])
  orderId          String?            @map("order")
  sum              Int?               @default(0)
  externalId       String             @default("")
  receiptId        String             @default("")
  status           PaymentStatusType? @default(created)
  createdAt        DateTime?          @default(now())
  lastModification DateTime?          @default(now()) @updatedAt

  @@index([orderId])
}

model Product {
  id                          String          @id @default(cuid())
  language                    String          @default("ru")
  statusView                  String          @default("draft")
  name                        String          @default("")
  description                 String          @default("")
  categories                  Category[]      @relation("Product_categories")
  images_filesize             Int?
  images_extension            String?
  images_width                Int?
  images_height               Int?
  images_id                   String?
  price                       Int?            @default(0)
  createdAt                   DateTime?       @default(now())
  lastModification            DateTime?       @default(now()) @updatedAt
  from_Category_products      Category[]      @relation("Category_products")
  from_ProductReview_products ProductReview[] @relation("ProductReview_products")
  from_Subscription_product   Subscription[]  @relation("Subscription_product")
}

model ProductReview {
  id               String    @id @default(cuid())
  language         String    @default("ru")
  statusView       String    @default("draft")
  student          User?     @relation("ProductReview_student", fields: [studentId], references: [id])
  studentId        String?   @map("student")
  products         Product[] @relation("ProductReview_products")
  desc             String    @default("")
  media            String    @default("")
  createdAt        DateTime? @default(now())
  lastModification DateTime? @default(now()) @updatedAt

  @@index([studentId])
}

model User {
  id                            String                @id @default(cuid())
  language                      String                @default("ru")
  avatar_filesize               Int?
  avatar_extension              String?
  avatar_width                  Int?
  avatar_height                 Int?
  avatar_id                     String?
  name                          String                @default("")
  email                         String                @unique @default("")
  password                      String?
  phone                         String                @default("")
  statusClient                  UserStatusClientType? @default(new)
  levelStudent                  UserLevelStudentType? @default(a1)
  goal                          String                @default("")
  source                        SourceClient[]        @relation("User_source")
  role                          UserRoleType?         @default(student)
  comment                       String                @default("")
  createdAt                     DateTime?             @default(now())
  lastModification              DateTime?             @default(now()) @updatedAt
  from_Cart_user                Cart[]                @relation("Cart_user")
  from_Order_student            Order[]               @relation("Order_student")
  from_Order_employee           Order[]               @relation("Order_employee")
  from_ProductReview_student    ProductReview[]       @relation("ProductReview_student")
  from_UserSubscription_student UserSubscription[]    @relation("UserSubscription_student")
  from_UserSubscription_manager UserSubscription[]    @relation("UserSubscription_manager")
  from_UserService_student      UserService[]         @relation("UserService_student")
  from_UserService_manager      UserService[]         @relation("UserService_manager")
  from_Page_author              Page[]                @relation("Page_author")
}

model SourceClient {
  id                       String         @id @default(cuid())
  name                     String         @default("")
  parent                   SourceClient?  @relation("SourceClient_parent", fields: [parentId], references: [id])
  parentId                 String?        @map("parent")
  createdAt                DateTime?      @default(now())
  lastModification         DateTime?      @default(now()) @updatedAt
  from_User_source         User[]         @relation("User_source")
  from_SourceClient_parent SourceClient[] @relation("SourceClient_parent")

  @@index([parentId])
}

model Subscription {
  id                       String             @id @default(cuid())
  language                 String             @default("ru")
  statusView               String             @default("draft")
  name                     String             @default("")
  visitCount               Int                @default(10)
  price                    Int
  period                   Int?               @default(45)
  product                  Product[]          @relation("Subscription_product")
  items                    UserSubscription[] @relation("UserSubscription_pattern")
  createdAt                DateTime?          @default(now())
  lastModification         DateTime?          @default(now()) @updatedAt
  from_Cart_subscriptions  Cart[]             @relation("Cart_subscriptions")
  from_Order_subscriptions Order[]            @relation("Order_subscriptions")
}

model UserSubscription {
  id               String        @id @default(cuid())
  language         String        @default("ru")
  pattern          Subscription? @relation("UserSubscription_pattern", fields: [patternId], references: [id])
  patternId        String?       @map("pattern")
  price            Int
  status           String        @default("inactive")
  student          User?         @relation("UserSubscription_student", fields: [studentId], references: [id])
  studentId        String?       @map("student")
  beginDate        DateTime?     @default(now())
  endDate          DateTime?
  payed            Int?
  totalVisited     Int?          @default(0)
  totalBurned      Int?          @default(0)
  manager          User?         @relation("UserSubscription_manager", fields: [managerId], references: [id])
  managerId        String?       @map("manager")
  createdAt        DateTime?     @default(now())
  lastModification DateTime?     @default(now()) @updatedAt

  @@index([patternId])
  @@index([studentId])
  @@index([managerId])
}

model Service {
  id                  String        @id @default(cuid())
  language            String        @default("ru")
  statusView          String        @default("draft")
  name                String        @default("")
  description         String        @default("")
  categories          Category[]    @relation("Service_categories")
  price               Int?          @default(0)
  items               UserService[] @relation("UserService_pattern")
  createdAt           DateTime?     @default(now())
  lastModification    DateTime?     @default(now()) @updatedAt
  from_Cart_services  Cart[]        @relation("Cart_services")
  from_Order_services Order[]       @relation("Order_services")
}

model UserService {
  id               String    @id @default(cuid())
  language         String    @default("ru")
  pattern          Service?  @relation("UserService_pattern", fields: [patternId], references: [id])
  patternId        String?   @map("pattern")
  price            Int
  status           String    @default("inactive")
  student          User?     @relation("UserService_student", fields: [studentId], references: [id])
  studentId        String?   @map("student")
  beginDate        DateTime? @default(now())
  payed            Int?
  manager          User?     @relation("UserService_manager", fields: [managerId], references: [id])
  managerId        String?   @map("manager")
  createdAt        DateTime? @default(now())
  lastModification DateTime? @default(now()) @updatedAt

  @@index([patternId])
  @@index([studentId])
  @@index([managerId])
}

model Page {
  id               String    @id @default(cuid())
  language         String    @default("ru")
  statusView       String    @default("draft")
  title            String    @default("")
  slug             String    @unique @default("")
  description      String    @default("")
  content          Json      @default("[{\"type\":\"paragraph\",\"children\":[{\"text\":\"\"}]}]")
  tag              Tag[]     @relation("Page_tag")
  author           User?     @relation("Page_author", fields: [authorId], references: [id])
  authorId         String?   @map("author")
  createdAt        DateTime? @default(now())
  lastModification DateTime? @default(now()) @updatedAt

  @@index([authorId])
}

model Tag {
  id               String     @id @default(cuid())
  language         String     @default("ru")
  title            String     @default("")
  category         Category[] @relation("Tag_category")
  createdAt        DateTime?  @default(now())
  lastModification DateTime?  @default(now()) @updatedAt
  from_Page_tag    Page[]     @relation("Page_tag")
}

enum OrderStatusType {
  created
  frozen
  processing
  finished
  cancelled
}

enum PaymentStatusType {
  created
  successfully
  cancelled
  error
}

enum UserStatusClientType {
  new
  firstCall
  recordFirstLesson
  trialLesson
  decisionAfterTrialLesson
  LowQualityLead
  client
  disabledClient
  rejection
}

enum UserLevelStudentType {
  a1
  a2
  b1
  b2
  c1
}

enum UserRoleType {
  admin
  manager
  teacher
  student
}